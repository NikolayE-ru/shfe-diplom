# Дипломная работа по профессии Frontend-разработчик

## Технологический стек

- [x] **Языки**: `TypeScript`, `SCSS`.

- [x] **Фреймворки и библиотеки**:
  - **Frontend**: `React` (v19), `React Router` (v7), `Vite`.

  - **Стилизация**: `SCSS`, `Bootstrap` (кастомная сборка).

  - **API**: `Axios` для HTTP-запросов.

  - **Дополнительные библиотеки**:
    - `date-fns` — работа с датами (календарь).

    - `react-icons` — иконки.

    - `react-toastify` — всплывающие уведомления.

    - `qrcode.react` — генерация QR-кодов.

- [x] **Сервер**:
  - Прокси-сервер (`vite.config.ts`) для API (`https://shfe-diplom.neto-server.ru`).

- [x] **Сборка и инструменты**:
  - `Vite` — быстрая сборка проекта.

  - `ESLint` + `Prettier` — линтинг и форматирование кода.

  - `TypeScript` — статическая типизация.

## Особенности проекта

- **Валидация** данных (к примеру, проверка конфликтов сеансов).

- **Адаптивный дизайн** для работы на мобильных устройствах.

## Ссылки на задачи к проекту и развернутый проект

- [x] [Условия дипломной работы](https://github.com/netology-code/shfe-diplom 'Ссылка на задание по дипломному проекту')<br>
- [x] [Развернутый проект на GitHub Pages - Гостевая страница](https://nikolaye-ru.github.io/shfe-diplom/ 'Ссылка на проект')<br>
- [x] [Развернутый проект на GitHub Pages - Страница администратора](https://nikolaye-ru.github.io/shfe-diplom/admin 'Ссылка на проект')

## Основные модули и их функционал

### 1. Гостевой интерфейс

Гостевой интерфейс — для просмотра фильмов, выбора сеансов и бронирования билетов.

**Принцип работы**:

- Пользователь выбирает дату в календаре.

- Видит список доступных фильмов и сеансов.

- Выбирает сеанс, места в зале и бронирует билеты.

- Получает QR-код для входа.

![Guest](assets/ReadmePics/guest-pic.png)

- [x] **Главная страница** (`GuestPage`):
  - Отображает список фильмов с постерами, описанием и сеансами (`MovieCard`).
  - Позволяет выбрать дату с помощью календаря (`Calendar`).
  - Фильтрует сеансы по выбранной дате.

- [x] **Страница зала** (`HallPage`):
  - Показывает схему зала (`HallScheme`) с местами (обычные, VIP, заблокированные).
  - Позволяет выбрать места и перейти к бронированию.

- [x] **Страница билета** (`TicketPage`):
  - Отображает информацию о бронировании (фильм, места, стоимость).
  - Генерирует QR-код для подтверждения брони.

### 2. Административный интерфейс

Административный интерфейс — для управления залами, фильмами, сеансами и настройки цен.

**Принцип работы**:

- Администратор настраивает залы (ряды, места, цены).

- Добавляет фильмы и сеансы, избегая конфликтов.

- Управляет продажами (включает/выключает для залов).

![Admin](assets/ReadmePics/admin-pic.png)

- [x] **Страница авторизации** (`LoginPage`):
  <br>
  Отображает форму авторизации для доступа к админ-панели. Для доступа к административной панели используйте:
  - **Логин**:
  ```bash
   shfe-diplom@netology.ru
  ```
  - **Пароль**:
  ```bash
  shfe-diplom
  ```

- [x] **Страница администратора** (`AdminPanel`):
      Содержит нижеперечисленные компоненты, обернутые в компонент (аккордеон-панель) с функцией раскрытия/закрытия (`AdminAccordionSection`) ⬇️.
  - **Управление залами** (`HallsManagement`):
    - Добавление залов с помощью попапа (`AddHallPopup`).
    - Удаление и выбор залов.
    - Компонент выбора залов (`HallsList`) является общим и для других секции (**HallConfig**, **HallPrices**, **HallOpen**),
      обеспечивая тем самым работу с одним залом во всей админ-панели, без необходимости переключения зала в каждой секции.

  - **Конфигурация залов** (`HallConfig`):
    - Настройка рядов, мест и типов кресел (обычные, VIP, заблокированные).

  - **Конфигурация цен** (`HallPrices`):
    - Установка цен для разных типов мест.

  - **Сетка сеансов** (`SeancesGridSection`):
    - Добавление фильмов с помощью попапа (`AddMoviePopup`).
    - Удаление фильмов.
    - Перетаскивание сеансов на временную шкалу с помощью **Drag-and-drop** и попапа (`AddSeancePopup`).
    - Удаление сеансов.
    - Проверка сеансов на конфликты.

  - **Открытие продаж** (`HallOpenSection`):
    - Включение/выключение продаж билетов для залов.

### 3. Общие компоненты

- [x] **Авторизация** (`AuthContext` → (`useAuth`, `AuthProvider`)):
  - Вход для администратора через логин/пароль.

- [x] **Контексты** (`HallsContext` → (`useHalls`, `HallsProvider`),
      `GuestContext` → (`useGuest`, `GuestProvider`)):
  - Хранение и обновление данных о залах, фильмах и сеансах (State management). Для гостевой страницы - `GuestContext`,
    для страницы администратора - `HallsContext`.

- [x] **API** (`api.ts`):
  - Запросы к серверу для управления данными.

- [x] **Модалки** (`ConfirmDeleteModal`):
  - Модальное окно для подтверждения удаления (фильмы, сеансы, залы).

## Запуск проекта

1. **Установка зависимостей**:

```bash
npm install
```

2. **Просмотр клиентской части** (localhost:5173):

```bash
npm run dev
```

3. **Сборка проекта** (в корневой папке dist):

```bash
npx vite build
```

4. **Просмотр собранной версии** (localhost:4173):

```bash
npm run preview
```

## Мок тест и валидация

- [x] **Мок-тест** (`api.test`):

1. Создает mock данные для фильмов, залов и сеансов. Используемые библиотеки:
  - **Vitest** - Test runner
  - **MSW** - Mock Service Worker для тестов API
  - **Testing Library** - Утилиты для тестирования React

2. Настраивает mock сервер с обработчиками для всех endpoints API
  - `GET /alldata` - Получение всех данных (фильмы, залы, сеансы)
  - `POST /hall` - Добавление нового зала
  - `POST /hall/:id` - Обновление конфигурации зала
  - `POST /price/:id` - Обновление цен зала
  - `POST /open/:id` - Управление статусом продаж
  - `DELETE /hall/:id` - Удаление зала
  - `POST /film` - Добавление фильма
  - `DELETE /film/:id` - Удаление фильма
  - `POST /seance` - Добавление сеанса
  - `DELETE /seance/:id` - Удаление сеанса
  - `GET /hallconfig` - Получение конфигурации зала
  - `POST /ticket` - Бронирование билетов

3. Реализует тесты для всех основных CRUD операций:
   - Получение всех данных
     - should fetch all data

   - Работа с залами (добавление, удаление, обновление конфигурации)
     - should add a new hall
     - should get hall config
     - should update hall config
     - should update hall prices
     - should update hall status
     - should delete a hall

   - Работа с фильмами (добавление, удаление)
     - should add a new film
     - should delete a film

   - Работа с сеансами (добавление, удаление)
     - should add a new seance
     - should delete a seance

4. Включает тесты для обработки ошибок

Тесты проверяют как успешные сценарии, так и обработку ошибок (например, при попытке удалить несуществующий зал).

**Запуск теста**:

```bash
npm test
```

**Проверка кода линтером**:

```bash
npm run lint
```

**Проверка TypeScript типов**:

```bash
npm run type-check
```

**Валидация** (комплексный запуск проверок кода проекта с помощью lint, type-check, и мок-теста jest):

```bash
npm run validate
```

_PS. Если валидация запускается с ошибками, попробуйте запустить исправление проблем линтинга_:

```bash
npm run lint:fix
```

###### Статус прокрытия модуля api.ts тестами:

[![Build status](https://ci.appveyor.com/api/projects/status/oxgi3txswpn3b95l/branch/main?svg=true)](https://ci.appveyor.com/project/Nikolay87-ru/shfe-diplom/branch/main)
